FROM python:3.10-alpine
LABEL maintainer="Oscar Carballal Prego <oscar@lareira.digital>"

WORKDIR /app

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PYTHONPATH=/app

RUN apk add --no-cache \
        curl \
        gcc \
        libressl-dev \
        musl-dev \
        libffi-dev \
    && curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py | python - \
    && apk del \
        curl \
        gcc \
        libressl-dev \
        musl-dev \
        libffi-dev

# Make directories
RUN mkdir -p /app_config
RUN mkdir -p /app

# Install dependencies
COPY . /app/
RUN poetry install --no-dev --no-root --no-interaction

EXPOSE 80

CMD hypercorn -c file:/app/hypercorn_config.toml